{% extends 'base.html' %}

{% block title %}{{ action }} K-Drama Post{% endblock %}

{% block content %}

<div class="form-container">
    <h2 style="margin-bottom: 10px; color: #d8a8d8; font-size: 32px;">{{ action }} K-Drama Post</h2>
    <p style="color: #a89aa8; margin-bottom: 30px;">Share your K-Drama stories and moments...</p>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.title.id_for_label }}" style="font-weight: 700;">Title *</label>
            {{ form.title }}
            {% if form.title.errors %}
                <p style="color: #d8a8d8; font-size: 13px; margin-top: 5px;">{{ form.title.errors.0 }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.category.id_for_label }}" style="font-weight: 700;">Category *</label>
            {{ form.category }}
            {% if form.category.errors %}
                <p style="color: #d8a8d8; font-size: 13px; margin-top: 5px;">{{ form.category.errors.0 }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.excerpt.id_for_label }}" style="font-weight: 700;">Brief Summary</label>
            {{ form.excerpt }}
            <p style="color: #a89aa8; font-size: 12px; margin-top: 5px;">A short summary that will appear in post cards</p>
            {% if form.excerpt.errors %}
                <p style="color: #d8a8d8; font-size: 13px; margin-top: 5px;">{{ form.excerpt.errors.0 }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.featured_image.id_for_label }}" style="font-weight: 700;">K-Drama Poster/Featured Image</label>
            <div style="position: relative; margin-top: 10px;">
                <input type="file" id="{{ form.featured_image.id_for_label }}" name="featured_image" accept="image/*" 
                       style="display: none;" onchange="previewImage(event)">
                <button type="button" onclick="document.getElementById('{{ form.featured_image.id_for_label }}').click()"
                        style="width: 100%; padding: 30px; background: rgba(200, 127, 199, 0.2); border: 2px dashed #d8a8d8; border-radius: 10px; color: #d8a8d8; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;">
                    ðŸ“¸ Click to upload poster image (JPG, PNG)
                </button>
                <div id="imagePreview" style="margin-top: 15px; display: none;">
                    <img id="previewImg" style="max-width: 100%; max-height: 300px; border-radius: 10px; box-shadow: 0 10px 30px rgba(200, 127, 199, 0.2);">
                    <p style="color: #a89aa8; font-size: 12px; margin-top: 10px; text-align: center;" id="fileName"></p>
                </div>
            </div>
            {% if form.featured_image.errors %}
                <p style="color: #d8a8d8; font-size: 13px; margin-top: 5px;">{{ form.featured_image.errors.0 }}</p>
            {% endif %}
            <p style="color: #a89aa8; font-size: 12px; margin-top: 10px;">Recommended: Landscape image (16:9 aspect ratio) for best display</p>
        </div>

        <div class="form-group">
            <label for="{{ form.content.id_for_label }}" style="font-weight: 700;">Content *</label>
            {{ form.content }}
            {% if form.content.errors %}
                <p style="color: #d8a8d8; font-size: 13px; margin-top: 5px;">{{ form.content.errors.0 }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.status.id_for_label }}" style="font-weight: 700;">Status *</label>
            {{ form.status }}
            <p style="color: #a89aa8; font-size: 12px; margin-top: 5px;">Draft: Not visible to public | Published: Visible immediately</p>
            {% if form.status.errors %}
                <p style="color: #d8a8d8; font-size: 13px; margin-top: 5px;">{{ form.status.errors.0 }}</p>
            {% endif %}
        </div>

        <div style="display: flex; gap: 15px; margin-top: 40px;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">{{ action }} K-Drama Post</button>
            <a href="{% if post %}{% url 'blog:post_detail' post.slug %}{% else %}{% url 'blog:home' %}{% endif %}" class="btn btn-secondary" style="flex: 1; text-align: center;">Cancel</a>
        </div>
    </form>
</div>

<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const fileName = document.getElementById('fileName');
            
            previewImg.src = e.target.result;
            fileName.textContent = 'Selected: ' + file.name;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}
</script>

{% endblock %}